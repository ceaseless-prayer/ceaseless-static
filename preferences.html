<!DOCTYPE HTML>
<!--
	Alpha by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <meta name="description" content=""/>
  <meta name="keywords" content=""/>
  <!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.dropotron.min.js"></script>
    <script src="js/jquery.scrollgress.min.js"></script>
    <script src="js/skel.min.js"></script>
    <script src="js/skel-layers.min.js"></script>
    <script src="js/init.js"></script>
    <script src="js/contact-form.js"></script>
    <script src="js/jquery.qs.js"></script>
    <noscript>
      <link rel="stylesheet" href="css/skel.css" />
      <link rel="stylesheet" href="css/style.css" />
      <link rel="stylesheet" href="css/style-wide.css" />
    </noscript>
    <link rel="stylesheet" href="css/ceaseless-custom.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->

</head>


<body>
<link rel="stylesheet" href="css/progress-bar.css" />
<!-- Header -->
<header id="header">
  <h1><a href="index.html"><img class="logo header-logo" src="images/logo-white.png"/></a></h1>
  <nav id="nav">
    <ul>
      <li><a href="index.html">Home</a></li>
      <li>
        <a href="" class="icon fa-angle-down">Menu</a>
        <ul>
          <li><a href="default.html">Home</a></li>
          <li><a href="preferences.html">Preferences</a></li>
          <li><a href="contact.html">Contact Us</a></li>
          <li><a href="donate.html">Give</a></li>
          <li><a href="contact.html?subject=I need help">Get Help</a></li>
          <li><a href="share.html">Share Ceaseless</a></li>
        </ul>
      </li>
    </ul>
  </nav>
</header>



<style type="text/css">
    .preferences, .preferences_saved, .preferences_not_saved, .sending_spinner,
    .suspend-account-link, .enable-account-link
    {
        display: none;
    }
</style>
<section class="container" id="main">
  <header>
    <h2>Change Preferences</h2>
  </header>
  <div class="box">
    <div class="loading-spinner">
  <img src="images/spinner.gif"/>
</div>


    <div class="fb-login-wrapper">
  <div
    class="fb-login-button"
    data-show-faces="false"
    data-width="300"
    data-max-rows="2"
    data-size="large"
    data-scope="email,user_status,friends_likes,friends_photos,friends_status">
  </div>
</div>

    <form>
      <div class="row">
        <div class="6u">
          <label for="friends_per_digest">How many friends do you want to pray for each day?</label>
          <div class="select-wrapper">
            <select id="friends_per_digest">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
            </select>
          </div>
          <br/>
        </div>
        <div class="6u">
          <label for="time">When do you want to receive the reminder?</label>
          <div class="select-wrapper">
            <select id="time">
              <option value="0">Midnight</option>
              <option value="3">3 AM</option>
              <option value="6">6 AM</option>
              <option value="9">9 AM</option>
              <option value="12">Noon</option>
              <option value="15">3 PM</option>
              <option value="18">6 PM</option>
              <option value="21">9 PM</option>
            </select>
          </div>
          <br/>
        </div>
      </div>
      <div class="row">
        <div class="12u">
          <!-- TODO Skipping dealing with the timezone problem for now -->
          <label for="pause">Do you need a break?</label>
          <input type="checkbox" id="pause"/><label for="pause">Take a 7 day break</label>
        </div>
      </div>
      <hr/>
      <div class="row">
          <div class="6u">
            <button class="button big special" id="save" type="submit">Submit</button>
            <a href="default.html" class="button big" id="close" type="button">Close</a>
            <br/>
            <span class="sending_spinner">
              <img src="images/spinner.gif"/>
            </span>
            <div class="preferences_saved">
              <label>All set!</label>
            </div>
            <div class="preferences_not_saved">
              <label>Sorry, we couldn't save your preferences at this time.</label>
            </div>
            <br/>
          </div>
          <div class="6u">
            <div id="other_actions">
                <header>
                    <h3>Other actions:</h3>
                </header>
                <ul>
                    <li><a href="default.html"><span class="icon fa-home"></span>&nbsp;Return home</a></li>
                    <li class="suspend-account-link"><a href="suspend.html?suspend=true"><span class="icon fa-remove"></span> Suspend account</a></li>
                    <li class="enable-account-link"><a href="suspend.html?suspend=false"><span class="icon fa-check"></span> Enable account</a></li>
                </ul>
            </div>
          </div>
      </div>
    </form>
  </div>
</section>
<script type="text/javascript">
    var showSuspensionBtn = function () {
        $.ajax({
            type: 'GET',
            url: '/api/suspend.php',
            dataType: 'json',
            success: function (data) {
                var isSuspended = data.isSuspended;
                if (isSuspended) {
                    $(".enable-account-link").show();
                } else {
                    $(".suspend-account-link").show();
                }
            },
            async: true
        });
    };

    var savePreferences = function (e) {
        e.preventDefault();
        var email = $("#email").val();
        var friends_per_digest = $("#friends_per_digest").val();
        var time = $("#time").val();
        var pause_duration = 0;
        if($("#pause").prop("checked")) {
            pause_duration = $("#pause_duration").text();
        }
        $("span.sending_spinner").show();
        $.ajax({
            type: 'GET',
            url: '/savePreferences.php',
            dataType: 'json',
            success: function (data) {
                $("span.sending_spinner").hide();
                if (data.success) {
                    $(".preferences_not_saved").hide();
                    $(".preferences_saved").show().delay(5000).fadeOut(300);
                } else {
                    $(".preferences_saved").hide();
                    $(".preferences_not_saved").show().delay(5000).fadeOut(300);
                }
            },
            data: {
                'access_token': FB.getAccessToken(),
                'fb_id': FB.getUserID(),
                'email': email,
                'friends_per_digest': friends_per_digest,
                'time': time,
                'pause_duration' : pause_duration
            },
            async: true
        });
    };

    $("#save").on("click", savePreferences);

</script>
<script type="text/javascript">
  var fbInitActions = {
    connected: function () {
      refreshToken();
      showSuspensionBtn();
      var preferences = getPreferences();
      $("#friends_per_digest option").filter(function () {
          return $(this).text() == preferences.friends_per_digest;
      }).prop('selected', true);
      $("#time option").filter(function () {
          return $(this).val() == preferences.time;
      }).prop('selected', true);

      if(preferences.pause_duration > 0) {
          $("#pause").prop("checked", true);
          $("#pause_duration").text(preferences.pause_duration);
      }

      $("div.loading_spinner").hide();
      $("div.fb-login-wrapper").hide();
      $("div.preferences").show();
    }
  };
</script>


<!-- Footer -->
  <footer id="footer">
    <ul class="icons">
  <li><a href="http://www.twitter.com/ceaselessprayer" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
  <li><a href="https://www.facebook.com/ceaselesspraying" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
  <li><a href="http://www.github.com/chrislim/ceaseless-static" class="icon fa-github"><span class="label">Github</span></a></li>
  <!--<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
  <li><a href="#" class="icon fa-dribbble"><span class="label">Dribbble</span></a></li>
  <li><a href="#" class="icon fa-google-plus"><span class="label">Google+</span></a></li>-->
</ul>

    <ul class="copyright">
      <li>&copy; TheoTech. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
    </ul>
  </footer>

<script type="text/javascript">
    // Load the SDK Asynchronously
    (function(d){
        var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement('script'); js.id = id; js.async = true;
        js.src = "//connect.facebook.net/en_US/all.js";
        ref.parentNode.insertBefore(js, ref);
    }(document));
</script>
<script type="text/javascript" src="js/fb-lib.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44378341-1', 'auto');
  ga('send', 'pageview');

</script>

</body>

</html>
